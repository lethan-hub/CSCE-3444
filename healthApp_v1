# !/usr/bin/env python3

from personal_health import PersonalHealth
from workouts import workouts
from meals import meals
from user_auth import login_user, register_user

def prompt_login_or_register():
    while True:
        choice = input("Do you want to (1) Login or (2) Register? ").strip()
        if choice == "1":
            username = input("Username: ").strip()
            password = input("Password: ").strip()
            user = login_user(username, password)
            if user:
                print("Login successful!\n")
                return user
            else:
                print("Invalid credentials. Try again.\n")
        elif choice == "2":
            username = input("Choose a username: ").strip()
            password = input("Choose a password: ").strip()
            email = input("Enter your email: ").strip()
            print(register_user(username, password, email))
        else:
            print("Invalid input. Enter 1 or 2.\n")

def workouts_placeholder():
    print("\n[Workouts]")
    print("ğŸ‘‰  This is where workout routines would go.\n")
    


def meal_planning(username):
    meals(username)


def personal_health(username):
    print("\n[Personal Health]")
    print("ğŸ‘‰  This is where health metrics & tips would go.\n")
    try:
        name = input("Enter your name: ")
        age = int(input("Enter your age: "))
        gender = input("Enter your gender: ")
        height_cm = float(input("Enter your height(in cm): "))
        weight_kg = float(input("Enter your weight(in kg): "))

        profile = PersonalHealth(name,age,gender,height_cm,weight_kg, username=username)
        profile.save() # Saves to the .json file

        print("Personal Health Overview")
        for key,value in profile.profile().items():
            print(f"{key} : {value}")

    except ValueError:
        print("Invalid input. Please enter valid inputs for the required sections.")

    input("Press Enter to return to Main Menu")


def main_menu(username: str):
    
    while True:
        print(f"\nHi, {username.capitalize()}!")
        print("==== Home Screen ====")
        print("1. Workouts ğŸƒ")
        print("2. Meal Planning ğŸ…")
        print("3. Personal Health ğŸ“")
        print("4. Quit")

        choice = input("Select an option (1-4): ").strip()

        if choice == "1":
            workouts(username)
        elif choice == "2":
            meal_planning(username)
        elif choice == "3":
            personal_health(username)
        elif choice == "4":
            print("ğŸ‘‹ Goodbye â€” stay healthy!\n")
            break
        else:
            print("Invalid selection. Please try again.")


if __name__ == "__main__":
    user = prompt_login_or_register()
    main_menu(user)

